  /**
   * Removes consecutive duplicates, so that [A B B C D A] becomes [A B C D A].
   */
  private <T> List<T> stripDuplicates(List<T> list) {
    list = Lists.newArrayList(list);

    Iterator i = list.iterator();
    if (i.hasNext()) {
      for (Object last = i.next(), current; i.hasNext(); last = current) {
        current = i.next();
        if (last.equals(current)) {
          i.remove();
        }
      }
    }

    return ImmutableList.copyOf(list);
  }

