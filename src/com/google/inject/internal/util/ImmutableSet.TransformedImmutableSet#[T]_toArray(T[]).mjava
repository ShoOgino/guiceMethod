    @SuppressWarnings("unchecked")
    @Override public <T> T[] toArray(T[] array) {
      int size = size();
      if (array.length < size) {
        array = ObjectArrays.newArray(array, size);
      } else if (array.length > size) {
        array[size] = null;
      }

      for (int i = 0; i < source.length; i++) {
        array[i] = (T) transform(source[i]);
      }
      return array;
    }

