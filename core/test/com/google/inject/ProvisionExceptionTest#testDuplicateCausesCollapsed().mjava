  public void testDuplicateCausesCollapsed() {
    final RuntimeException sharedException = new RuntimeException("fail");
    Injector injector =
        Guice.createInjector(
            new AbstractModule() {

              @Provides
              Integer i() {
                throw sharedException;
              }

              @Provides
              Double d() {
                throw sharedException;
              }
            });

    try {
      injector.getInstance(DoubleFailure.class);
      fail();
    } catch (ProvisionException pe) {
      assertEquals(sharedException, pe.getCause());
      assertEquals(2, pe.getErrorMessages().size());
      for (Message message : pe.getErrorMessages()) {
        assertEquals(sharedException, message.getCause());
      }
    }
  }

