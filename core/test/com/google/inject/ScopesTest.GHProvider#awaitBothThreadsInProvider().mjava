    void awaitBothThreadsInProvider() {
      try {
        bothThreadsAreInProvider.await(DEADLOCK_TIMEOUT_SECONDS, TimeUnit.SECONDS);
        fail();
      } catch (TimeoutException expected) {
        // first thread to arrive should timeout as we never enter providers from both threads
      } catch (BrokenBarrierException expected) {
        // second thread to arrive should fail as barrier is broken by the first thread's timeout
      } catch (Exception e) {
        throw new RuntimeException(e);
      }
    }

