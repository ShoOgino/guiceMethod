  public void testThatFinalizerStops() {
    weaklyReferenceQueue();

    // wait up to 5s
    for (int i = 0; i < 500; i++) {
      if (queueReference.get() == null) {
        return;
      }
      try {
        System.gc();
        Thread.sleep(10);
      } catch (InterruptedException e) { /* ignore */ }
    }
    fail();
  }

