  /** Returns the current dependency chain (all the state). */
  public List<DependencyAndSource> getDependencyChain() {
    ImmutableList.Builder<DependencyAndSource> builder = ImmutableList.builder();
    for (int i = 0; i < state.size(); i += 2) {
      builder.add(new DependencyAndSource(
          (Dependency<?>) state.get(i), state.get(i + 1)));
    }
    return builder.build();
  }

