  public final void testAsyncServiceLifecycle() throws InterruptedException {
    ExecutorService executor = Executors.newSingleThreadExecutor();

    final CountDownLatch latch = new CountDownLatch(2);
    AsyncService service = new AsyncService(executor) {
      @Override protected void onStart() {
        assertEquals(2, latch.getCount());

        latch.countDown();
      }

      @Override protected void onStop() {
        assertEquals(1, latch.getCount());

        latch.countDown();
      }
    };

    service.start();
    latch.await(2, TimeUnit.SECONDS);

    service.stop();
    latch.await(2, TimeUnit.SECONDS);

    executor.shutdown();
    assertEquals(0, latch.getCount());
  }

